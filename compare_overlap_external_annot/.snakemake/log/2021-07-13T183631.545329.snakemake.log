Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cluster nodes: 100
Job counts:
	count	jobs
	1	all
	1	calculate_train_test_ROC_precall_against_bg
	2	get_segment_file_train_test
	2	get_segmentation_based_on_entropy
	4	overlap_against_background
	4	overlap_with_genome_contexts
	14

[Tue Jul 13 18:36:34 2021]
rule get_segmentation_based_on_entropy:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/POSTERIOR/entropy/entropy_chr1.txt.gz, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/POSTERIOR/entropy/entropy_chrX.txt.gz
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/genome_segments_sorted.bed.gz
    jobid: 28
    wildcards: num_mark_model=all_mark_model, num_state=25

Submitted job 28 with external jobid 'Submitted batch job 2386904'.

[Tue Jul 13 18:36:34 2021]
rule get_segmentation_based_on_entropy:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/POSTERIOR/entropy/entropy_chr1.txt.gz, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/POSTERIOR/entropy/entropy_chrX.txt.gz
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/genome_segments_sorted.bed.gz
    jobid: 29
    wildcards: num_mark_model=three_mark_model, num_state=8

Submitted job 29 with external jobid 'Submitted batch job 2386905'.
[Tue Jul 13 18:45:24 2021]
Finished job 29.
1 of 14 steps (7%) done

[Tue Jul 13 18:45:24 2021]
rule get_segment_file_train_test:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/genome_segments_sorted.bed.gz, ../../model_analysis/train_segments_sorted.bed.gz, ../../model_analysis/test_segments_sorted.bed.gz
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    jobid: 25
    wildcards: model_folder=../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy

Submitted job 25 with external jobid 'Submitted batch job 2387196'.
[Tue Jul 13 18:45:34 2021]
Finished job 28.
2 of 14 steps (14%) done

[Tue Jul 13 18:45:34 2021]
rule get_segment_file_train_test:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/genome_segments_sorted.bed.gz, ../../model_analysis/train_segments_sorted.bed.gz, ../../model_analysis/test_segments_sorted.bed.gz
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    jobid: 24
    wildcards: model_folder=../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy

Submitted job 24 with external jobid 'Submitted batch job 2387198'.
[Tue Jul 13 18:47:14 2021]
Finished job 25.
3 of 14 steps (21%) done

[Tue Jul 13 18:47:14 2021]
rule overlap_with_genome_contexts:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/train_overlap.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/test_overlap.txt
    jobid: 18
    wildcards: model_folder=../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy, fore_or_back=foreground

Submitted job 18 with external jobid 'Submitted batch job 2387209'.

[Tue Jul 13 18:47:14 2021]
rule overlap_with_genome_contexts:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/train_overlap.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/test_overlap.txt
    jobid: 19
    wildcards: model_folder=../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy, fore_or_back=background

Submitted job 19 with external jobid 'Submitted batch job 2387210'.
[Tue Jul 13 18:47:35 2021]
Finished job 24.
4 of 14 steps (29%) done

[Tue Jul 13 18:47:35 2021]
rule overlap_with_genome_contexts:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/train_overlap.txt, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/test_overlap.txt
    jobid: 17
    wildcards: model_folder=../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy, fore_or_back=background

Submitted job 17 with external jobid 'Submitted batch job 2387215'.

[Tue Jul 13 18:47:36 2021]
rule overlap_with_genome_contexts:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/train_segments.bed.gz, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/train_and_test_segments_sorted/test_segments.bed.gz
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/train_overlap.txt, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/test_overlap.txt
    jobid: 16
    wildcards: model_folder=../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy, fore_or_back=foreground

Submitted job 16 with external jobid 'Submitted batch job 2387216'.
[Tue Jul 13 18:48:05 2021]
Finished job 18.
5 of 14 steps (36%) done
[Tue Jul 13 18:48:35 2021]
Finished job 16.
6 of 14 steps (43%) done
[Tue Jul 13 18:51:15 2021]
Finished job 19.
7 of 14 steps (50%) done

[Tue Jul 13 18:51:15 2021]
rule overlap_against_background:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/train_overlap.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/train_overlap.txt
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt
    jobid: 8
    wildcards: model_folder=../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy, TT=train

Submitted job 8 with external jobid 'Submitted batch job 2387539'.

[Tue Jul 13 18:51:15 2021]
rule overlap_against_background:
    input: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/test_overlap.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/test_overlap.txt
    output: ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt
    jobid: 9
    wildcards: model_folder=../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy, TT=test

Submitted job 9 with external jobid 'Submitted batch job 2387540'.
[Tue Jul 13 18:51:35 2021]
Finished job 17.
8 of 14 steps (57%) done

[Tue Jul 13 18:51:35 2021]
rule overlap_against_background:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/train_overlap.txt, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/train_overlap.txt
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt
    jobid: 6
    wildcards: model_folder=../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy, TT=train

[Tue Jul 13 18:51:35 2021]
Finished job 8.
9 of 14 steps (64%) done
[Tue Jul 13 18:51:35 2021]
Finished job 9.
10 of 14 steps (71%) done
Submitted job 6 with external jobid 'Submitted batch job 2387542'.

[Tue Jul 13 18:51:36 2021]
rule overlap_against_background:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/foreground/test_overlap.txt, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/background/test_overlap.txt
    output: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt
    jobid: 7
    wildcards: model_folder=../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy, TT=test

Submitted job 7 with external jobid 'Submitted batch job 2387543'.
[Tue Jul 13 18:51:55 2021]
Finished job 6.
11 of 14 steps (79%) done
[Tue Jul 13 18:52:05 2021]
Finished job 7.
12 of 14 steps (86%) done

[Tue Jul 13 18:52:05 2021]
rule calculate_train_test_ROC_precall_against_bg:
    input: ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt, ../../model_analysis/K562_hg19/all_mark_model/state_25/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt, ../../model_analysis/K562_hg19/three_mark_model/state_8/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt, ../../data/hg19/K562/roadmap_published_chromHMM/25_state/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt, ../../data/hg19/K562/roadmap_published_chromHMM/25_state/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt, ../../model_analysis/K562_hg19/simple_rules_from_natalie/overlap_crispr_mpra/fg_against_bg/train_overlap_against_bg.txt, ../../model_analysis/K562_hg19/simple_rules_from_natalie/overlap_crispr_mpra/fg_against_bg/test_overlap_against_bg.txt
    output: ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_Fulco19_significant_DE_G_ST6a.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_gasperini19_altScale_664_enhancerGenePairs_ST2B.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_gasperini19_pilot_145_EnhancerGenePairs_ST1B.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S1_discovery_K562_sgrna.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S2_discovery_K562_bin2.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S3_discovery_K562_bin3.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S5_discovery_K562_dhs.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S6_validation_K562_sgrna.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S7_validation_K562_bin2.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S8_validation_K562_bin3.txt
    jobid: 3

Submitted job 3 with external jobid 'Submitted batch job 2387544'.
[Tue Jul 13 18:52:15 2021]
Error in rule calculate_train_test_ROC_precall_against_bg:
    jobid: 3
    output: ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_Fulco19_significant_DE_G_ST6a.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_gasperini19_altScale_664_enhancerGenePairs_ST2B.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_gasperini19_pilot_145_EnhancerGenePairs_ST1B.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S1_discovery_K562_sgrna.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S2_discovery_K562_bin2.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S3_discovery_K562_bin3.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S5_discovery_K562_dhs.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S6_validation_K562_sgrna.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S7_validation_K562_bin2.txt, ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg/auc_klann21_S8_validation_K562_bin3.txt
    shell:
        
		model_type="all_mark_model three_mark_model"
		all_mark_max_nState=25
		three_mark_max_nState=8
		overlap_folder_list=""
		model_name_list=""
		num_model=0
		for ns in `seq 25 ${all_mark_max_nState}`
		do
			this_overlap_folder=../../model_analysis/K562_hg19/all_mark_model/state_${ns}/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg
			overlap_folder_list="$overlap_folder_list $this_overlap_folder"
			this_model_name="M13_S${ns}"
			model_name_list="$model_name_list $this_model_name"
			num_model=$(( $num_model + 1 ))
		done
		for ns in `seq 8 ${three_mark_max_nState}`
		do
			this_overlap_folder=../../model_analysis/K562_hg19/three_mark_model/state_${ns}/full_model/segment_based_on_entropy/overlap_crispr_mpra/fg_against_bg
			overlap_folder_list="$overlap_folder_list $this_overlap_folder"
			this_model_name="M3_S${ns}"
			model_name_list="$model_name_list $this_model_name"
			num_model=$(( $num_model + 1 ))
		done
		num_model=$(( $num_model + 2 ))
		roadmap_overlap_folder=../../data/hg19/K562/roadmap_published_chromHMM//25_state/overlap_crispr_mpra/fg_against_bg
		simple_rules_overlap_folder=../../model_analysis/K562_hg19/simple_rules_from_natalie/overlap_crispr_mpra/fg_against_bg
		overlap_folder_list="$overlap_folder_list $roadmap_overlap_folder $simple_rules_overlap_folder"
		model_name_list="$model_name_list roadmap_S25 simpleRules_S3" 
		python ./scripts/calculate_roc_enrichment_against_bg_train_test.py $num_model ../../model_analysis/K562_hg19/compare_models_recover_crispr_mpra/entropy_stratified/fg_against_bg ${overlap_folder_list} ${model_name_list}
		
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)
    cluster_jobid: Submitted batch job 2387544

Error executing rule calculate_train_test_ROC_precall_against_bg on cluster (jobid: 3, external: Submitted batch job 2387544, jobscript: /gstore/home/vuh6/source/compare_overlap_external_annot/.snakemake/tmp.3lj8tlpl/snakejob.calculate_train_test_ROC_precall_against_bg.3.sh). For error details see the cluster log and the log files of the involved rule(s).
Shutting down, this might take some time.
Exiting because a job execution failed. Look above for error message
Complete log: /gstore/home/vuh6/source/compare_overlap_external_annot/.snakemake/log/2021-07-13T183631.545329.snakemake.log
